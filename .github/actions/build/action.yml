name: Build client
description: Github Action for building static file of client
author: Phong Phi
branding: 
  color: blue
  icon: command

inputs: 
  generate_sourcemap: 
    description: "Generate sourcemap or not"
    required: true
  api_server_hostname: 
    description: "Hostname of API server"
    required: false
  websocket_server_hostname:
    description: "Hostname of Websocket server"
    required: false
  repository:
    description: "Build repository"
    required: true
  sdk_api_key:
    description: "Video SDK API key"
    required: false

runs: 
  using: composite
  steps: 
    - name: Build
      shell: bash
      env: 
        GENERATE_SOURCEMAP: ${{ inputs.generate_sourcemap }}
        REACT_APP_GRAPHQL_URI: ${{ inputs.api_server_hostname }}
        REACT_APP_WEBSOCKET_URL: ${{ inputs.websocket_server_hostname }}
        REACT_APP_VIDEOSDK_API_KEY: ${{ inputs.sdk_api_key }}
      run: |
        cd ${{ inputs.repository }}
        echo "Setting general environment variables..."
        export NODE_ENV=production
        export NODE_OPTIONS=--max_old_space_size=4096
        export GENERATE_SOURCEMAP=false
        CI= yarn build 